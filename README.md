
# Парсер Wildberries с Telegram-ботом

## Описание проекта

Данный проект представляет собой парсер для анализа товаров на маркетплейсе Wildberries, реализованный в виде Telegram-бота. Бот принимает ссылку на товар, анализирует его, определяет ключевые поисковые запросы и находит текущие позиции товара в поисковой выдаче по этим запросам.

## Технологии

- **Python 3** — основной язык программирования
- **aiogram** — асинхронная библиотека для создания Telegram-ботов
- **requests** — для HTTP-запросов к API Wildberries
- **BeautifulSoup** — для парсинга HTML-страниц
- **NLTK** — для обработки естественного языка и извлечения ключевых слов
- **dotenv** — для управления переменными окружения
- **asyncio** — для асинхронного выполнения операций
- **Docker** — для контейнеризации приложения

## Функциональность

Бот выполняет следующие задачи:
- Принимает ссылку на товар Wildberries
- Извлекает информацию о товаре (название, бренд, цену, описание)
- Определяет ключевые поисковые запросы на основе названия и описания товара
- Выполняет поиск товара в выдаче Wildberries по каждому ключевому запросу
- Определяет позицию товара в результатах поиска
- Формирует и отправляет отчет с результатами анализа

## Структура проекта

```
app/
├── main.py          # Точка входа, настройка и запуск бота
├── bot.py           # Основная логика бота
├── product_data.py  # Извлечение данных о товаре с Wildberries
├── process.py       # Обработка данных и извлечение ключевых слов
├── healthcheck.py   # Сервер проверки здоровья контейнера
└── search.py        # Поиск позиций товара в выдаче Wildberries
Dockerfile           # Инструкции для сборки Docker-образа
docker-compose.yml   # Конфигурация сервисов Docker
.env                 # Переменные окружения
```

## Компоненты

### main.py
Настраивает окружение, загружает переменные окружения, инициализирует и запускает бота.

### bot.py
Содержит класс `WildberriesParserBot`, который обрабатывает сообщения пользователей, команды и управляет процессом анализа.

### product_data.py
Содержит функции для извлечения информации о товаре из Wildberries с использованием API и парсинга страницы.

### process.py
Реализует алгоритм извлечения ключевых запросов из названия и описания товара с использованием NLTK.

### search.py
Содержит функции для поиска товара в выдаче Wildberries и определения его позиции по каждому запросу.

## Установка и запуск с Docker

1. Клонируйте репозиторий:
```bash
git clone <репозиторий>
cd WB_parser
```

2. Создайте файл `.env` с токеном Telegram-бота:
```
TELEGRAM_BOT_TOKEN=ваш_токен_бота
```

3. Соберите и запустите Docker-контейнер:
```bash
docker compose up -d --build
```

4. Для просмотра логов:
```bash
docker compose logs -f
```

5. Для остановки контейнера:
```bash
docker compose down -v
```

## Использование

1. Найдите своего бота в Telegram
2. Отправьте команду `/start` для начала работы
3. Отправьте ссылку на товар Wildberries (например, https://www.wildberries.ru/catalog/12345678/detail.aspx)
4. Дождитесь результатов анализа

## Преимущества Docker-контейнеризации

- **Изоляция** — приложение работает в изолированной среде со всеми зависимостями
- **Воспроизводимость** — одинаковая работа на разных окружениях
- **Масштабируемость** — легкий деплой на серверы
- **Удобство обслуживания** — простое обновление и перезапуск

## Алгоритм работы

1. **Извлечение данных о товаре**:
   - Получение ID товара из URL
   - Запрос к API Wildberries для получения основной информации
   - Парсинг страницы товара для дополнительных данных

2. **Определение ключевых запросов**:
   - Токенизация названия и описания товара
   - Удаление стоп-слов
   - Подсчет частотности слов
   - Формирование релевантных запросов на основе бренда, категории и частых слов

3. **Поиск позиций в выдаче**:
   - Для каждого ключевого запроса выполняется поиск на Wildberries
   - Просмотр результатов выдачи (до 10 страниц)
   - Определение позиции товара в общем списке результатов

4. **Формирование отчета**:
   - Информация о товаре (название, бренд, цена)
   - Список ключевых запросов
   - Позиции товара по каждому запросу
   - Статистика (среднее положение, количество найденных позиций)

## Особенности

- Асинхронная обработка запросов для повышения производительности
- Защита от блокировки с использованием случайных задержек и ротации User-Agent
- Извлечение ключевых слов с учетом русскоязычной морфологии
- Поддержка различных форматов URL Wildberries
- Автоматический перезапуск контейнера при сбоях благодаря настройкам Docker
